---
import Layout from "../../layouts/Layout.astro";
import CharacterCard from "../../components/CharacterCard.astro";
import { getCharacters } from "../../data/characters";
import heroGenshin from "../../assets/hero-genshin.png";

const characters = await getCharacters();
---

<Layout title="Genshin Impact DB - Home" lang="en">
	<div
		class="relative h-[600px] flex items-center justify-center overflow-hidden"
	>
		<div class="absolute inset-0 z-0">
			<img
				src={heroGenshin.src}
				alt="Genshin Impact Background"
				class="w-full h-full object-cover blur-[3px] scale-105 opacity-55"
			/>
			<div
				class="absolute inset-0 bg-gradient-to-b from-slate-950/60 via-slate-900/70 to-slate-900"
			>
			</div>
		</div>

		<div class="relative z-10 text-center px-4 max-w-4xl mx-auto mt-20">
			<h1
				class="text-5xl md:text-7xl font-bold mb-6 text-white drop-shadow-lg tracking-tight"
			>
				Explore <span
					class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-yellow-500"
					>Teyvat</span
				>
			</h1>
			<p
				class="text-xl md:text-2xl text-slate-200 mb-8 max-w-2xl mx-auto shadow-black drop-shadow-md"
			>
				Your ultimate database for characters, weapons, and artifacts in
				Genshin Impact.
			</p>
			<div class="flex flex-wrap gap-4 justify-center">
				<a
					href="#characters"
					class="bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold py-3 px-8 rounded-full transition-all hover:scale-105 shadow-[0_0_20px_rgba(234,179,8,0.5)]"
				>
					View Characters
				</a>
				<a
					href="#"
					class="bg-slate-700/80 hover:bg-slate-700 text-white font-bold py-3 px-8 rounded-full transition-all hover:scale-105 border border-slate-600 backdrop-blur-sm"
				>
					Interactive Map
				</a>
			</div>
		</div>
	</div>

	<section
		id="characters"
		class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20"
	>
		<div class="flex items-center justify-between mb-12">
			<div>
				<h2 class="text-3xl font-bold text-white mb-2">
					Character List
				</h2>
				<div class="h-1 w-20 bg-yellow-500 rounded-full"></div>
			</div>

			<div class="hidden sm:block">
				<div class="inline-flex rounded-md shadow-sm" role="group" id="rarity-filters">
					<button
						type="button"
						data-rarity-filter="all"
						aria-pressed="true"
						class="px-4 py-2 text-sm font-medium border border-slate-600 rounded-l-lg transition-colors bg-yellow-500 text-slate-900 hover:bg-yellow-400"
					>
						All
					</button>
					<button
						type="button"
						data-rarity-filter="5"
						aria-pressed="false"
						class="px-4 py-2 text-sm font-medium text-white bg-slate-700 border-t border-b border-slate-600 hover:bg-slate-600 transition-colors"
					>
						5★
					</button>
					<button
						type="button"
						data-rarity-filter="4"
						aria-pressed="false"
						class="px-4 py-2 text-sm font-medium text-white bg-slate-700 border border-slate-600 rounded-r-lg hover:bg-slate-600 transition-colors"
					>
						4★
					</button>
				</div>
			</div>
		</div>

		<div
			id="character-grid"
			class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6"
		>
			{characters.map((char) => (
				<div data-character-card data-rarity={String(char.rarity)}>
					<CharacterCard character={char} />
				</div>
			))}
		</div>

		<div class="mt-12 text-center">
			<button
				class="text-slate-400 hover:text-white font-medium border-b border-transparent hover:border-white transition-colors pb-1"
			>
				Load More Characters
			</button>
		</div>
	</section>
</Layout>

<script>
	const filterButtons = Array.from(document.querySelectorAll<HTMLButtonElement>("[data-rarity-filter]"));
	const characterCards = Array.from(document.querySelectorAll<HTMLElement>("[data-character-card]"));

	const setButtonState = (activeFilter: string) => {
		for (const button of filterButtons) {
			const buttonFilter = button.dataset.rarityFilter ?? "all";
			const isActive = buttonFilter === activeFilter;
			button.setAttribute("aria-pressed", String(isActive));
			button.classList.toggle("bg-yellow-500", isActive);
			button.classList.toggle("text-slate-900", isActive);
			button.classList.toggle("hover:bg-yellow-400", isActive);
			button.classList.toggle("bg-slate-700", !isActive);
			button.classList.toggle("text-white", !isActive);
			button.classList.toggle("hover:bg-slate-600", !isActive);
		}
	};

	const applyRarityFilter = (filter: string) => {
		for (const card of characterCards) {
			const rarity = card.dataset.rarity;
			const shouldShow = filter === "all" || rarity === filter;
			card.classList.toggle("hidden", !shouldShow);
		}

		setButtonState(filter);
	};

	for (const button of filterButtons) {
		button.addEventListener("click", () => {
			applyRarityFilter(button.dataset.rarityFilter ?? "all");
		});
	}
</script>
