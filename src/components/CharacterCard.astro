---
import type { Character } from "../data/characters";
import anemoIcon from "../assets/elements/anemo.png";
import cryoIcon from "../assets/elements/cryo.png";
import electroIcon from "../assets/elements/electro.png";
import dendroIcon from "../assets/elements/dendro.png";
import geoIcon from "../assets/elements/geo.png";
import hydroIcon from "../assets/elements/hydro.png";
import pyroIcon from "../assets/elements/pyro.png";

interface Props {
    character: Character;
}

const { character } = Astro.props;

// Map elements to colors (simplified)
const elementColors: Record<string, string> = {
    Pyro: "text-red-500 bg-red-100/10 border-red-500/20",
    Hydro: "text-blue-500 bg-blue-100/10 border-blue-500/20",
    Anemo: "text-teal-400 bg-teal-100/10 border-teal-500/20",
    Electro: "text-purple-500 bg-purple-100/10 border-purple-500/20",
    Dendro: "text-green-500 bg-green-100/10 border-green-500/20",
    Cryo: "text-cyan-400 bg-cyan-100/10 border-cyan-500/20",
    Geo: "text-yellow-500 bg-yellow-100/10 border-yellow-500/20",
};

const elementIcons: Record<string, string> = {
    Anemo: anemoIcon.src,
    Cryo: cryoIcon.src,
    Electro: electroIcon.src,
    Dendro: dendroIcon.src,
    Geo: geoIcon.src,
    Hydro: hydroIcon.src,
    Pyro: pyroIcon.src
};

const elementClass = elementColors[character.element] || "text-gray-400";
const elementIconSrc = elementIcons[character.element];
---

<div
    class="group relative bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 border border-slate-700 hover:border-slate-600 block cursor-pointer"
>
    <div class="aspect-square w-full overflow-hidden bg-slate-900">
        <img
            src={character.imageUrl}
            alt={character.name}
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            loading="lazy"
            referrerpolicy="no-referrer"
            data-fallback={character.fallbackImageUrl}
            onerror="const fallback = this.getAttribute('data-fallback'); if (fallback && this.src !== fallback) { this.src = fallback; return; } this.onerror = null; this.src = '/favicon.svg';"
        />
        <!-- Rarity Badge overlay -->
        <div
            class={`absolute top-2 right-2 px-2.5 py-1 rounded-md text-[11px] font-semibold tracking-wide shadow-lg backdrop-blur-sm ring-1 ${character.rarity === 5 ? "bg-yellow-400/90 text-slate-900 ring-yellow-200/80" : "bg-purple-500/90 text-white ring-purple-300/80"}`}
        >
            <span class="inline-flex items-center gap-1">
                {character.rarity}
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="h-3.5 w-3.5"
                    aria-hidden="true"
                >
                    <path
                        d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321 1.01l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0l-4.725 2.885a.562.562 0 0 1-.84-.61l1.285-5.385a.562.562 0 0 0-.182-.557l-4.204-3.602a.563.563 0 0 1 .321-1.01l5.518-.442a.563.563 0 0 0 .475-.345l2.125-5.11Z"
                    ></path>
                </svg>
            </span>
        </div>

        {elementIconSrc && (
            <div class="absolute top-2 left-2 p-1.5 rounded-md bg-slate-900/65 border border-slate-600/70 backdrop-blur-sm">
                <img src={elementIconSrc} alt={character.element} class="h-4 w-4" loading="lazy" />
            </div>
        )}
    </div>

    <div class="p-4">
        <h3
            class="text-lg font-bold text-white mb-1 group-hover:text-yellow-400 transition-colors"
        >
            {character.name}
        </h3>
        <div class="flex items-center justify-between">
            <span
                class={`text-sm font-medium px-2 py-0.5 rounded border ${elementClass}`}
            >
                {character.elementLabel ?? character.element}
            </span>
            <span class="text-xs text-slate-400 uppercase tracking-wide"
                >{character.weaponLabel ?? character.weapon}</span
            >
        </div>
    </div>
</div>
